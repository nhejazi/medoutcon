<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Causal Mediation Analysis for Stochastic Interventions • medshift</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Causal Mediation Analysis for Stochastic Interventions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medshift</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro_medshift.html">Causal Mediation Analysis for Stochastic Interventions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nhejazi/medshift">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Causal Mediation Analysis for Stochastic Interventions</h1>
                        <h4 class="author">
<a href="https://nimahejazi.org">Nima Hejazi</a> and <a href="https://www.idiaz.xyz/">Iván Díaz</a>
</h4>
            
            <h4 class="date">2019-01-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nhejazi/medshift/blob/master/vignettes/intro_medshift.Rmd"><code>vignettes/intro_medshift.Rmd</code></a></small>
      <div class="hidden name"><code>intro_medshift.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>We are interested in assessing the direct effect (DE) and the indirect effect (IE), based on the decomposition of the population mediated intervention mean given in <span class="citation">Díaz and Hejazi (2019)</span>.</p>
<p>To proceed, we’ll use as our running example a simple data set from an observational study of the relationship between BMI and kids behavior, distributed as part of the <a href="https://CRAN.R-project.org/package=mma"><code>mma</code> R package on CRAN</a>. First, let’s load the packages we’ll be using and set a seed; then, load this data set and take a quick look at it</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># preliminaries</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(data.table)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sl3)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(medshift)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mma)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">429153</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># load and examine data</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(weight_behavior)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(weight_behavior)</a></code></pre></div>
<pre><code>## [1] 691  15</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(weight_behavior)</a></code></pre></div>
<pre><code>##        bmi  age sex  race numpeople car gotosch snack tvhours cmpthours
## 1 18.20665 12.2   F OTHER         5   3       2     1       4         0
## 2 22.78401 12.8   M OTHER         4   3       2     1       4         2
## 3 19.60725 12.6   F OTHER         4   2       4     2      NA        NA
## 4 25.56754 12.1   M OTHER         2   3       2     1       0         2
## 5 15.07408 12.3   M OTHER         4   1       2     1       2         1
## 6 22.98338 11.8   M OTHER         4   1       1     1       4         3
##   cellhours sports exercises sweat overweigh
## 1         0      2         2     1         0
## 2         0      1         8     2         0
## 3        NA   &lt;NA&gt;         4     2         0
## 4         0      2         9     1         1
## 5         3      1        12     1         0
## 6         2      1         1     1         0</code></pre>
<p>The documentation for the data set describes it as a “database obtained from the Louisiana State University Health Sciences Center, New Orleans, by Dr. Richard Scribner. He explored the relationship between BMI and kids behavior through a survey at children, teachers and parents in Grenada in 2014. This data set includes 691 observations and 15 variables.”</p>
<p>Unfortunately, the data set contains a few observations with missing values. As these are unrelated to the object of our analysis, we’ll simply remove these for the time being. Note that in a real data analysis, we might consider strategies to fully make of the observed data, perhaps by imputing missing values. For now, we simply remove the incomplete observations, resulting in a data set with fewer observations but much the same structure as the original:</p>
<pre><code>## [1] 567  15</code></pre>
<pre><code>##        bmi  age sex  race numpeople car gotosch snack tvhours cmpthours
## 1 18.20665 12.2   F OTHER         5   3       2     1       4         0
## 2 22.78401 12.8   M OTHER         4   3       2     1       4         2
## 4 25.56754 12.1   M OTHER         2   3       2     1       0         2
## 5 15.07408 12.3   M OTHER         4   1       2     1       2         1
## 6 22.98338 11.8   M OTHER         4   1       1     1       4         3
## 8 19.15658 12.1   F OTHER         3   3       2     1       0         0
##   cellhours sports exercises sweat overweigh
## 1         0      1         2     1         0
## 2         0      0         8     2         0
## 4         0      1         9     1         1
## 5         3      0        12     1         0
## 6         2      0         1     1         0
## 8         1      0         1     3         0</code></pre>
<p>For the analysis of this observational data set, we focus on the effect of participating in a sports team (<code>sports</code>) on the BMI of children (<code>bmi</code>), taking several related covariates as mediators (<code>snack</code>, <code>exercises</code>, <code>overweigh</code>) and all other collected covariates as potential confounders. Considering an NPSEM, we separate the observed variables from the data set into their corresponding nodes as follows</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">Y &lt;-<span class="st"> </span>weight_behavior_complete<span class="op">$</span>bmi</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">A &lt;-<span class="st"> </span>weight_behavior_complete<span class="op">$</span>sports</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">Z &lt;-<span class="st"> </span>weight_behavior_complete <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(snack, exercises, overweigh)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">W &lt;-<span class="st"> </span>weight_behavior_complete <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(age, sex, race, numpeople, car, gotosch, tvhours, cmpthours,</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">         cellhours, sweat)</a></code></pre></div>
<p>Finally, in our analysis, we consider an incremental propensity score intervention (IPSI), as first proposed by <span class="citation">Kennedy (2018)</span>, wherein the <em>odds of participating in a sports team</em> is modulated by some fixed amount (<span class="math inline">\(0 \leq \delta \leq \infty\)</span>) for each individual. Such an intervention may be interpreted as the effect of a school program that motivates children to participate in sports teams. To exemplify our approach, we postulate a motivational intervention that <em>triples the odds</em> of participating in a sports team for each individual:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">delta_shift_ipsi &lt;-<span class="st"> </span><span class="dv">3</span></a></code></pre></div>
<p>To easily incorporate ensemble machine learning into the estimation procedure, we rely on the facilities provided in the <a href="https://tlverse.org/sl3"><code>sl3</code> R package</a> <span class="citation">(Coyle et al. 2018)</span>. For a complete guide on using the <code>sl3</code> R package, consider consulting <a href="https://tlverse.org/sl3" class="uri">https://tlverse.org/sl3</a>, or <a href="https://tlverse.org" class="uri">https://tlverse.org</a> (and <a href="https://github.com/tlverse" class="uri">https://github.com/tlverse</a>) for the <code>tlverse</code> ecosystem, of which <code>sl3</code> is a major part. We construct an ensemble learner using a handful of popular machine learning algorithms below</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># SL learners used for continuous data (the nuisance parameter M)</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">xgb_contin_lrnr &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">50</span>, <span class="dt">objective =</span> <span class="st">"reg:linear"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">hal_contin_lrnr &lt;-<span class="st"> </span>Lrnr_hal9001<span class="op">$</span><span class="kw">new</span>(<span class="dt">n_folds =</span> <span class="dv">5</span>, <span class="dt">degrees =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">enet_contin_lrnr &lt;-<span class="st"> </span>Lrnr_glmnet<span class="op">$</span><span class="kw">new</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">family =</span> <span class="st">"gaussian"</span>,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                                    <span class="dt">nfolds =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">lasso_contin_lrnr &lt;-<span class="st"> </span>Lrnr_glmnet<span class="op">$</span><span class="kw">new</span>(<span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">family =</span> <span class="st">"gaussian"</span>,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                                     <span class="dt">nfolds =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">fglm_contin_lrnr &lt;-<span class="st"> </span>Lrnr_glm_fast<span class="op">$</span><span class="kw">new</span>(<span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">gaussian</a></span>())</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">contin_lrnr_lib &lt;-<span class="st"> </span>Stack<span class="op">$</span><span class="kw">new</span>(enet_contin_lrnr, lasso_contin_lrnr,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">                             fglm_contin_lrnr, xgb_contin_lrnr,</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">                             hal_contin_lrnr)</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">sl_contin_lrnr &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(<span class="dt">learners =</span> contin_lrnr_lib,</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">                              <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>())</a>
<a class="sourceLine" id="cb9-14" data-line-number="14"></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co"># SL learners used for binary data (nuisance parameters G and E in this case)</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">xgb_binary_lrnr &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">50</span>, <span class="dt">objective =</span> <span class="st">"reg:logistic"</span>)</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">hal_binary_lrnr &lt;-<span class="st"> </span>Lrnr_hal9001<span class="op">$</span><span class="kw">new</span>(<span class="dt">n_folds =</span> <span class="dv">5</span>, <span class="dt">degrees =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">                                    <span class="dt">fit_type =</span> <span class="st">"glmnet"</span>, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">enet_binary_lrnr &lt;-<span class="st"> </span>Lrnr_glmnet<span class="op">$</span><span class="kw">new</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">family =</span> <span class="st">"binomial"</span>,</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">                                    <span class="dt">nfolds =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">lasso_binary_lrnr &lt;-<span class="st"> </span>Lrnr_glmnet<span class="op">$</span><span class="kw">new</span>(<span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">family =</span> <span class="st">"binomial"</span>,</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">                                     <span class="dt">nfolds =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">fglm_binary_lrnr &lt;-<span class="st"> </span>Lrnr_glm_fast<span class="op">$</span><span class="kw">new</span>(<span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">binomial</a></span>())</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">binary_lrnr_lib &lt;-<span class="st"> </span>Stack<span class="op">$</span><span class="kw">new</span>(enet_binary_lrnr, lasso_binary_lrnr,</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">                             fglm_binary_lrnr, xgb_binary_lrnr,</a>
<a class="sourceLine" id="cb9-26" data-line-number="26">                             hal_binary_lrnr)</a>
<a class="sourceLine" id="cb9-27" data-line-number="27">sl_binary_lrnr &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(<span class="dt">learners =</span> binary_lrnr_lib,</a>
<a class="sourceLine" id="cb9-28" data-line-number="28">                              <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>())</a></code></pre></div>
<div id="decomposing-the-population-intervention-effect" class="section level2">
<h2 class="hasAnchor">
<a href="#decomposing-the-population-intervention-effect" class="anchor"></a>Decomposing the population intervention effect</h2>
<p>We may decompose the population intervention effect (PIE) in terms of a  and an : <span class="math display">\[\begin{equation*}
    \psi(\delta) = \overbrace{\mathbb{E}\{Y(g, q) -
                                  Y(g_\delta, q)\}}^{\text{PIDE}} +
                   \overbrace{\mathbb{E}\{Y(g_\delta, q) -
                                  Y(g_\delta, q_\delta)\}}^{\text{PIIE}}
\end{equation*}\]</span> This decomposition of the PIE as the sum of direct and indirect effects has an interpretation analogous to the corresponding standard decomposition of the average treatment effect. In the sequel, we will compute each of the components of the direct and indirect effects above using appropriate estimators as follows</p>
<ul>
<li>For <span class="math inline">\(\mathbb{E}\{Y(g, q)\}\)</span>, the sample mean <span class="math inline">\(\frac{1}{n}\sum_{i=1}^n Y_i\)</span> is sufficient;</li>
<li>for <span class="math inline">\(\mathbb{E}\{Y(g_{\delta}, q)\}\)</span>, a one-step efficient estimator for the pure effect (of altering the exposure mechanism but not the mediation mechanism), as proposed in <span class="citation">Díaz and Hejazi (2019)</span>; and,</li>
<li>for <span class="math inline">\(\mathbb{E}\{Y(g_{\delta}, q_{\delta})\}\)</span>, a one-step efficient estimator for the joint effect (of altering both the exposure and mediation mechanisms), as proposed in <span class="citation">Kennedy (2018)</span> and implemented in the <a href="https://github.com/ehkennedy/npcausal"><code>npcausal</code> R package</a>.</li>
</ul>
</div>
<div id="estimating-the-pure-non-mediated-effect" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-the-pure-non-mediated-effect" class="anchor"></a>Estimating the pure non-mediated effect</h2>
<p>As given in <span class="citation">Díaz and Hejazi (2019)</span>, the statistical functional identifying the pure effect <span class="math inline">\(\mathbb{E}\{Y(g_{\delta}, q)\}\)</span>, which corresponds to altering the exposure mechanism while keeping the mediation mechanism (and its reliance on the exposure) fixed, is <span class="math display">\[\begin{equation*}
\theta_0(\delta) = \int m_0(a, z, w) g_{0,\delta}(a \mid w) p_0(z, w)
d\nu(a, z, w),
\end{equation*}\]</span> for which a one-step nonparametric-efficient estimator is available. The corresponding <em>efficient influence function</em> (EIF) with respect to the nonparametric model <span class="math inline">\(\mathcal{M}\)</span> is <span class="math inline">\(D_{\eta,\delta}(o) = D^Y_{\eta,\delta}(o) + D^A_{\eta,\delta}(o) + D^{Z,W}_{\eta,\delta}(o) - \theta(\delta)\)</span>. The one-step estimator may be computed using the EIF estimating equation, making use of cross-fitting to circumvent any need for entropy conditions. The resultant estimator is <span class="math display">\[\begin{equation*}
  \hat{\theta}(\delta) = \frac{1}{n} \sum_{i = 1}^n D_{\hat{\eta}_{j(i)},
  \delta}(O_i) = \frac{1}{n} \sum_{i = 1}^n \left\{ D^Y_{\hat{\eta}_{j(i)},
  \delta}(O_i) + D^A_{\hat{\eta}_{j(i)}, \delta}(O_i) +
  D^{Z,W}_{\hat{\eta}_{j(i)}, \delta}(O_i) \right\},
\end{equation*}\]</span> which is implemented in the <code>medshift</code> R package <span class="citation">(Hejazi and Díaz 2019)</span>. We make use of that implementation to estimate <span class="math inline">\(\mathbb{E}\{Y(g_{\delta}, q)\}\)</span> via its one-step estimator <span class="math inline">\(\hat{\theta}(\delta)\)</span> below</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># let's compute the parameter where A (but not Z) are shifted</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">theta_eff &lt;-<span class="st"> </span><span class="kw"><a href="../reference/medshift.html">medshift</a></span>(<span class="dt">W =</span> W, <span class="dt">A =</span> A, <span class="dt">Z =</span> Z, <span class="dt">Y =</span> Y,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                      <span class="dt">delta =</span> delta_shift_ipsi,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                      <span class="dt">g =</span> sl_binary_lrnr,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                      <span class="dt">e =</span> sl_binary_lrnr,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                      <span class="dt">m =</span> sl_contin_lrnr,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">                      <span class="dt">phi =</span> fglm_contin_lrnr,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">                      <span class="dt">estimator =</span> <span class="st">"onestep"</span>,</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">                      <span class="dt">estimator_args =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">cv_folds =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(theta_eff)</a></code></pre></div>
<pre><code>##             lwr_ci          param_est             upr_ci 
##          18.758434           19.10965          19.460867 
##          param_var           eif_mean          estimator 
##           0.032111      -1.538315e-15 one-step efficient</code></pre>
</div>
<div id="estimating-the-direct-effect" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-the-direct-effect" class="anchor"></a>Estimating the Direct Effect</h2>
<p>Recall that, based on the decomposition outlined previously, the direct effect_ (DE) may be denoted <span class="math inline">\(\beta_{\text{DE}}(\delta) = \mathbb{E}Y - \theta_0(\delta)\)</span>. Thus, an estimator of the DE, <span class="math inline">\(\hat{\beta}_{\text{DE}}(\delta)\)</span> may be expressed as a composition of estimators of its constituent parameters: <span class="math display">\[\begin{equation*}
  \hat{\beta}_{\text{DE}}({\delta}) = \frac{1}{n} \sum_{i = 1}^n Y_i -
  \hat{\theta}(\delta).
\end{equation*}\]</span></p>
<p>Based on the above, we may construct an estimator of the DE using the quantities already computed. The convenience function below applies the simple delta method required in the case of a linear contrast between the two constituent parameters:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># convenience function to compute inference via delta method: EY1 - EY0</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">linear_contrast &lt;-<span class="st"> </span><span class="cf">function</span>(params, eifs, <span class="dt">ci_level =</span> <span class="fl">0.95</span>) {</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="co"># bounds for confidence interval</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  ci_norm_bounds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(stats<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">qnorm</a></span>(<span class="dt">p =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>ci_level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  param_est &lt;-<span class="st"> </span>params[[<span class="dv">1</span>]] <span class="op">-</span><span class="st"> </span>params[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  eif &lt;-<span class="st"> </span>eifs[[<span class="dv">1</span>]] <span class="op">-</span><span class="st"> </span>eifs[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  se_eif &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(eif) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(eif))</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  param_ci &lt;-<span class="st"> </span>param_est <span class="op">+</span><span class="st"> </span>ci_norm_bounds <span class="op">*</span><span class="st"> </span>se_eif</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="co"># parameter and inference</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(param_ci[<span class="dv">1</span>], param_est, param_ci[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(out) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lwr_ci"</span>, <span class="st">"param_est"</span>, <span class="st">"upr_ci"</span>)</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">}</a></code></pre></div>
<p>With the above convenience function in hand, we’ll construct or extract the necessary components from existing objects and simply apply the function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># parameter estimates and EIFs for components of direct effect</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">EY &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">eif_EY &lt;-<span class="st"> </span>Y <span class="op">-</span><span class="st"> </span>EY</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">params_de &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(EY, theta_eff<span class="op">$</span>theta)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">eifs_de &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(eif_EY, theta_eff<span class="op">$</span>eif)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co"># direct effect = EY - estimated quantity</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">de_est &lt;-<span class="st"> </span><span class="kw">linear_contrast</span>(params_de, eifs_de)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">de_est</a></code></pre></div>
<pre><code>##      lwr_ci   param_est      upr_ci 
## -0.45834907  0.01745764  0.49326435</code></pre>
<p>As given above, we have for our estimate of the direct effect <span class="math inline">\(\hat{\beta}_{\text{DE}}({\delta}) =\)</span> 0.017.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-coyle2018sl3">
<p>Coyle, Jeremy R, Nima S Hejazi, Ivana Malenica, and Oleg Sofrygin. 2018. <em>sl3: Pipelines for Machine Learning and Super Learning in R</em>. <a href="https://github.com/tlverse/sl3" class="uri">https://github.com/tlverse/sl3</a>.</p>
</div>
<div id="ref-diaz2019causal">
<p>Díaz, Iván, and Nima S Hejazi. 2019. “Causal Mediation Analysis for Stochastic Interventions.” <em>Submitted</em>. <a href="https://arxiv.org/abs/1901.02776" class="uri">https://arxiv.org/abs/1901.02776</a>.</p>
</div>
<div id="ref-hejazi2019medshift">
<p>Hejazi, Nima S, and Iván Díaz. 2019. <em>medshift: Causal Mediation Analysis for Stochastic Interventions in R</em>. <a href="https://github.com/nhejazi/medshift" class="uri">https://github.com/nhejazi/medshift</a>.</p>
</div>
<div id="ref-kennedy2017nonparametric">
<p>Kennedy, Edward H. 2018. “Nonparametric Causal Effects Based on Incremental Propensity Score Interventions.” <em>Journal of the American Statistical Association</em>. Taylor &amp; Francis.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#background">Background</a><ul class="nav nav-pills nav-stacked">
<li><a href="#decomposing-the-population-intervention-effect">Decomposing the population intervention effect</a></li>
      <li><a href="#estimating-the-pure-non-mediated-effect">Estimating the pure non-mediated effect</a></li>
      <li><a href="#estimating-the-direct-effect">Estimating the Direct Effect</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nima Hejazi, Iván Díaz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
